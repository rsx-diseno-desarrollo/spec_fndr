<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>SpecFinder BETA</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" href="img/favicon.ico">
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#000000">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- PWA Manifest END -->
<!-- Service Worker -->
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('sw.js?v=13')
        .then(reg => console.log('Service Worker registrado'))
        .catch(err => console.log('Error al registrar el Service Worker:', err));
    });
  }
</script>
<!-- Service Worker END -->
</head>
<body>
<header>
  <!-- Menu -->
  <button class="boton-menu"><img src="img/menu-icon.png"/></button>
<nav class="menu">
  <ul>
    <li><a href="#" data-section="seccion-producto">Producto</a></li>
    <li><a href="#" data-section="seccion-empaque">Empaque</a></li>
    <li><a href="#" data-section="seccion-componentes">Componentes</a></li>
  </ul>
</nav>
<!-- Menu END -->
</header>
<!-- Menu script -->
<script>
  const botonMenu = document.querySelector('.boton-menu');
  const menu = document.querySelector('.menu');

  botonMenu.addEventListener('click', () => {
    menu.classList.toggle('abierto');
  });
</script>
<!-- Menu script END -->
  
<!-- SheetJS -->
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<!-- SheetJS END -->

  <!-- SECCIONES -->
  <div class="header">
    <img src="img/spec-finder-logo.jpg"/>
    <h2>CONSULTA DE ESPECIFICACIONES</h2><br>
  </div>

  <!-- SECCION PRODUCTO -->
  <div id="seccion-producto" class="seccion activa">
  <h3>Especificaciones de producto</h3>
    <div class="buscador">
      <input type="text" id="parte" placeholder="No. de parte sin guiones">
      <select id="cliente">
        <option value="">-- Selecciona cliente --</option>
      </select>
      <select id="nombre">
        <option value="">-- Selecciona nombre --</option>
      </select>
    </div>
      <div id="results-prod"></div>
  </div>
  <!-- SECCION PRODUCTO END -->
  
  <!-- SECCION EMPAQUE -->
  <div id="seccion-empaque" class="seccion">
    <h3>Especificaciones de Empaque</h3>
    <p>Aquí podrás buscar specs de empaque :D</p>
  </div>
  <!-- SECCION EMPAQUE END -->

  <!-- SECCION COMPONENETES -->
  <div id="seccion-componentes" class="seccion"> 
  <h3>Especificaciones de Componentes</h3>
    <div class="buscador">
      <input type="text" id="codigoComp" placeholder="Código de componente">
      <select id="tipoComp">
        <option value="">-- Selecciona tipo --</option>
      </select>
    </div>
    <div id="results-comp"></div>
  </div>
  <!-- SECCION COMPONENETES END -->
  
<!-- Cargar excel -->
  <script>
  async function cargarExcel() {
    const url = "specs.xlsx";
    try {
        const response = await fetch(url);
        const arrayBuffer = await response.arrayBuffer();
        const workbook = XLSX.read(arrayBuffer, { type: 'array' });

        const allData = {};
        workbook.SheetNames.forEach(sheetName => {
            allData[sheetName] = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName]);
        });

        window.data = allData;
        console.log("Datos cargados:", allData);

        // Inicializar buscador para la hoja "prod"
        const specs = allData.prod;
        const clienteSelect = document.getElementById("cliente");
        const nombreSelect = document.getElementById("nombre");

        const clientes = [...new Set(specs.map(s => s["CLIENTE"]))];
        const nombres = [...new Set(specs.map(s => s["NOMBRE"]))];

        clientes.forEach(c => {
            const opt = document.createElement("option");
            opt.value = c;
            opt.textContent = c;
            clienteSelect.appendChild(opt);
        });

        nombres.forEach(n => {
            const opt = document.createElement("option");
            opt.value = n;
            opt.textContent = n;
            nombreSelect.appendChild(opt);
        });

        function buscar() {
        const parte = document.getElementById("parte").value.toLowerCase();
        const cliente = clienteSelect.value.toLowerCase();
        const nombre = nombreSelect.value.toLowerCase();

        const filtered = specs.filter(spec => {
        const partesArray = String(spec["NO. PARTE"] || "")
            .split(",")
            .map(p => p.trim().toLowerCase());

            return (
                (parte === "" || partesArray.some(p => p.includes(parte))) &&
                (cliente === "" || spec["CLIENTE"].toLowerCase() === cliente) &&
                (nombre === "" || spec["NOMBRE"].toLowerCase() === nombre)
            );
        });
    
        const resultsDiv = document.getElementById("results-prod");
        resultsDiv.innerHTML = "";
        filtered.forEach(spec => {
            resultsDiv.innerHTML += `
                <div class="spec">
                    <strong>${spec["CLIENTE"]}</strong><br>
                    Código: ${spec["CODIGO"]}<br>
                    No. de Parte: ${spec["NO. PARTE"]}<br>
                    Nombre: ${spec["NOMBRE"]}<br>
                    Ver: <a href="${spec["LIGA"]}" target="_blank">Abrir RMS</a>
                </div>
            `;
        });
    }
      
        document.getElementById("parte").addEventListener("input", buscar);
        clienteSelect.addEventListener("change", buscar);
        nombreSelect.addEventListener("change", buscar);

    // Inicializar buscador para la hoja "prod" END

    
// Inicializar buscador para la hoja "componentes"
const componentes = allData.componentes; // Asegúrate que la hoja se llame "componentes" en el Excel
const tipoSelect = document.getElementById("tipoComp");

// Obtener lista única de tipos
const tipos = [...new Set(componentes.map(c => c["TIPO DE COMPONENTE"]))];
tipos.forEach(t => {
  const opt = document.createElement("option");
  opt.value = t;
  opt.textContent = t;
  tipoSelect.appendChild(opt);
});

function buscarComponentes() {
  const codigo = document.getElementById("codigoComp").value.toLowerCase();
  const tipo = tipoSelect.value.toLowerCase();

  const filtered = componentes.filter(comp => {
    const codigosArray = String(comp["CODIGO COMPONENTES"] || "")
      .split(",")
      .map(c => c.trim().toLowerCase());

    return (
      (codigo === "" || codigosArray.some(c => c.includes(codigo))) &&
      (tipo === "" || comp["TIPO DE COMPONENTE"].toLowerCase() === tipo)
    );
  });

  const resultsDiv = document.getElementById("results-comp");
  resultsDiv.innerHTML = "";
  filtered.forEach(comp => {
    resultsDiv.innerHTML += `
      <div class="spec">
        <strong>${comp["TIPO DE COMPONENTE"]}</strong><br>
        Código(s): ${comp["CODIGO COMPONENTES"]}<br>
        Documento: ${comp["NOMBRE DE DOCUMENTO"]}<br>
        Ver: <a href="${spec["LIGA"]}" target="_blank">Abrir RMS</a>
  });
}

document.getElementById("codigoComp").addEventListener("input", buscarComponentes);
tipoSelect.addEventListener("change", buscarComponentes);
// Inicializar buscador para la hoja "componentes" END
    } 
    catch (error) {
        console.error("Error al cargar el Excel:", error);
    }
}
cargarExcel();
    
  document.querySelectorAll('.menu a').forEach(link => {
  link.addEventListener('click', e => {
    e.preventDefault();
    const target = link.dataset.section;
    document.querySelectorAll('.seccion').forEach(sec => sec.classList.remove('activa'));
    document.getElementById(target).classList.add('activa');
    localStorage.setItem('seccionActiva', target); // Guardar sección
    menu.classList.remove('abierto'); // Cerrar menú
  });
});

  // Restaurar sección activa al cargar
  window.addEventListener('load', () => {
  const ultimaSeccion = localStorage.getItem('seccionActiva');
  if (ultimaSeccion) {
    document.querySelectorAll('.seccion').forEach(sec => sec.classList.remove('activa'));
    document.getElementById(ultimaSeccion).classList.add('activa');
  }
});

</script>
</body>
</html>
