<!DOCTYPE html>
<html lang="es">
<head>
<!--
Autor: Auxiliar Diseño - Héctor Ulises Montes Hernández
Proyecto: Sitio de Especificaciones Técnicas
Nota: Este sitio y su UI fueron desarrollados por Héctor Ulises Montes Hernández.
-->
  <meta charset="UTF-8">
  <title>SpecFinder BETA</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" href="img/favicon.ico">
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#000000">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- PWA Manifest END -->
<!-- Service Worker -->
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('sw.js?v=14')
        .then(reg => console.log('Service Worker registrado'))
        .catch(err => console.log('Error at register Service Worker:', err));
    });
  }
</script>
<!-- Service Worker END -->
</head>
<body>
<header>
  <!-- Menu -->
  <button class="boton-menu"><img src="img/menu-icon.png" alt=""/></button>
<nav class="menu">
  <ul>
    <li><a href="#" data-section="seccion-producto">Producto</a></li>
    <li><a href="#" data-section="seccion-empaque">Empaque</a></li>
    <li><a href="#" data-section="seccion-componentes">Componentes</a></li>
  </ul>
</nav>
<!-- Menu END -->


<!-- Toggle de idioma -->
<div class="lang-toggle" style="position:fixed; top:12px; right:12px; z-index:999;">
  <button type="button" id="btn-es">ES</button>
  <button type="button" id="btn-en">EN</button>
</div>
</header>
  
<!-- SheetJS -->
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<!-- SheetJS END -->

  <!-- SECCIONES -->
  <div class="header">
    <img src="img/spec-finder-logo.jpg" alt="Logo Spec Finder"/>
    <h2>Busqueda de especificaciones</h2><br>
  </div>

  <!-- SECCION PRODUCTO -->
  <div id="seccion-producto" class="seccion activa">
  <h3>Especificaciones de producto</h3><br>
    <div class="buscador">
      <input type="text" id="parte" placeholder="Número de parte sin guión">
      <select id="cliente">
        <option value="">-- Seleccionar cliente --</option>
      </select>
      <select id="nombre">
        <option value="">-- Seleccionar tipo --</option>
      </select>
    </div>
      <div id="results-prod"></div>
  </div>
  <!-- SECCION PRODUCTO END -->
  
  

<!-- SECCION EMPAQUE -->
<div id="seccion-empaque" class="seccion">
  <h3>Especificaciones de empaque</h3>

  <!-- Buscador -->
  <div class="buscador">
    <select id="emp-cliente">
      <option value="">-- Seleccionar cliente --</option>
    </select>

    <div class="field with-autocomplete">
      <input type="text" id="emp-parte" placeholder="Número de parte" autocomplete="off">
      <div id="emp-autocomplete" class="autocomplete-items"></div>
    </div>
    <button id="emp-btn-buscar" class="btn btn-buscar" type="button">Buscar</button>
  </div>

  <!-- Resultados -->
  <div id="emp-results">
    <!-- Encabezado: NO. DE PARTE / CLIENTE -->
    <div id="emp-header" class="comp-header"></div>

    <!-- Tabla de detalles -->
    <div class="emp-table-wrap">
      <table id="emp-table" class="emp-table" aria-describedby="emp-header">
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>
<!-- SECCION EMPAQUE END -->
  
<!-- SECCION COMPONENTES -->
<div id="seccion-componentes" class="seccion">
      <h3>Especificaciones de componenetes</h3><br>
      <!-- Buscador -->
      <div class="buscador">
        <select id="tipoComp">
          <option value="">-- Seleccionar tipo --</option>
        </select>
	<div class="field with-autocomplete">
        <input type="text" id="codigoComp" placeholder="Código sin guiones" autocomplete="off">
        <div id="autocomplete-list" class="autocomplete-items"></div>
	</div>
        <!-- Botón Buscar -->
        <button id="btnBuscarComp" class="btn btn-buscar" type="button">Buscar</button>
      </div>
    <br>
    <!-- Resultados / Visor -->
    <div id="results-comp">
      <!-- Encabezado dinámico -->
      <div id="comp-header" class="comp-header"></div>
      <!-- Visor de imagen del componente -->
      <div id="viewer-comp" class="viewer-comp">
        <img id="comp-img" class="comp-img" alt="Imagen del componente">
      </div>
	<!-- Selector de unidad --> 
      	<div class="unidad-selector">
        	<label for="comp-unidad"><strong>Unidad:</strong></label>
        	<select id="comp-unidad">
          	<option value="mm" selected>mm</option>
          	<option value="in">in</option>
        	</select>
      	</div>

      <!-- Cotas debajo de la imagen -->
      <div id="cotas-list" class="cotas-list"></div>
    </div>
</div>
  <!-- SECCION COMPONENENTES END -->
  
  <!-- Tu archivo JS externo -->
    <script src="script.js"></script>
	<script src="script-comp.js"></script>
<script>
  // Idioma actual (persistido)
  let LANG = localStorage.getItem('lang') || 'es';
  // Diccionario en memoria
  let SpecFinderDict = {};

  // 1) Cargar diccionario
  async function loadDict() {
    const res = await fetch('dict.json');
    SpecFinderDict = await res.json();
  }

  // 2) Traductor display por clave en español
  function tDisplay(spanishKey) {
    if (!spanishKey) return '';
    const entry = SpecFinderDict[spanishKey];
    if (!entry) return spanishKey; // Fallback: muestra ES si no hay clave
    return entry[LANG] || entry['es'] || spanishKey;
  }

  // 3) Aplicar traducciones a elementos marcados
  function applyTranslationsToDOM() {
    // Cambia lang del documento (accesibilidad/SEO)
    document.documentElement.setAttribute('lang', LANG);

    // data-text -> innerText
    document.querySelectorAll('[data-text]').forEach(el => {
      const key = el.getAttribute('data-text');
      const translated = tDisplay(key);
      if (translated) el.textContent = translated;
    });

    // data-placeholder -> placeholder
    document.querySelectorAll('[data-placeholder]').forEach(el => {
      const key = el.getAttribute('data-placeholder');
      const translated = tDisplay(key);
      if (translated) el.setAttribute('placeholder', translated);
    });

    // data-alt -> alt
    document.querySelectorAll('[data-alt]').forEach(el => {
      const key = el.getAttribute('data-alt');
      const translated = tDisplay(key);
      if (translated) el.setAttribute('alt', translated);
    });

    // Resaltar botón activo
    document.getElementById('btn-es')?.classList.toggle('active', LANG === 'es');
    document.getElementById('btn-en')?.classList.toggle('active', LANG === 'en');
  }

  // 4) Re-render de contenido que viene del Excel
  //    Define estas funciones en tu script principal para regenerar selects/tablas usando tDisplay().
  function rerenderExcelDrivenUI() {
    // Ejemplos (ajusta a tus funciones reales):
    if (window.renderEmpaqueSelects) window.renderEmpaqueSelects();     // vuelve a llenar selects de Empaque
    if (window.renderProductoSelects) window.renderProductoSelects();   // vuelve a llenar selects de Producto
    if (window.renderEmpaqueTable) window.renderEmpaqueTable();         // vuelve a dibujar tabla de Empaque
    if (window.renderComponentView) window.renderComponentView();       // vuelve a pintar visor de componentes
  }

  // 5) Cambiar idioma (toggle)
  function setLanguage(lang) {
    LANG = lang;
    localStorage.setItem('lang', lang);
    applyTranslationsToDOM();
    rerenderExcelDrivenUI();
  }

  // 6) Bootstrap
  document.addEventListener('DOMContentLoaded', async () => {
    await loadDict();
    applyTranslationsToDOM();

    // Eventos de los botones ES/EN
    const btnES = document.getElementById('btn-es');
    const btnEN = document.getElementById('btn-en');
    btnES?.addEventListener('click', () => setLanguage('es'));
    btnEN?.addEventListener('click', () => setLanguage('en'));
  });

  // 7) Helpers globales que puedes usar en tus renders de Excel
  //    Mantén tDisplay accesible desde otros scripts:
  window.tDisplay = tDisplay;
  window.getLang = () => LANG;

</script>
</body>
</html>
