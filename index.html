<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>SpecFinder BETA</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" href="img/favicon.ico">
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#000000">

<!-- Service Worker -->
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('sw.js')
        .then(reg => console.log('Service Worker registrado'))
        .catch(err => console.log('Error al registrar el Service Worker:', err));
    });
  }
</script>
  
</head>
<body>
  <div class="header">
  <img src="img/spec-finder-logo.jpg" />
  <h2>Consulta de Especificaciones</h2>
  </div>
  <div class="buscador">
  <input type="text" id="parte" placeholder="No. de parte sin guiones">
  <select id="cliente">
    <option value="">-- Selecciona cliente --</option>
  </select>
  <select id="nombre">
    <option value="">-- Selecciona nombre --</option>
  </select>
  </div>
  <div id="results"></div>

  <script>
  fetch('specs.json')
    .then(response => response.json())
    .then(data => {
      const specs = data;

      const clienteSelect = document.getElementById("cliente");
      const nombreSelect = document.getElementById("nombre");

      const clientes = [...new Set(specs.map(s => s["CLIENTE"]))];
      const nombres = [...new Set(specs.map(s => s["NOMBRE"]))];

      clientes.forEach(c => {
        const opt = document.createElement("option");
        opt.value = c;
        opt.textContent = c;
        clienteSelect.appendChild(opt);
      });

      nombres.forEach(n => {
        const opt = document.createElement("option");
        opt.value = n;
        opt.textContent = n;
        nombreSelect.appendChild(opt);
      });

      function buscar() {
        const parte = document.getElementById("parte").value.toLowerCase();
        const cliente = clienteSelect.value.toLowerCase();
        const nombre = nombreSelect.value.toLowerCase();

        const filtered = specs.filter(spec =>
          (parte === "" || String(spec["NO. PARTE"]).toLowerCase().includes(parte)) &&
          (cliente === "" || spec["CLIENTE"].toLowerCase() === cliente) &&
          (nombre === "" || spec["NOMBRE"].toLowerCase() === nombre)
        );

        const resultsDiv = document.getElementById("results");
        resultsDiv.innerHTML = "";
        filtered.forEach(spec => {
          resultsDiv.innerHTML += `
            <div class="spec">
              <strong>${spec["CLIENTE"]}</strong><br>
              No. de Parte: ${spec["NO. PARTE"]}<br>
              CÃ³digo: ${spec["CODIGO"]}<br>
              Nombre: ${spec["NOMBRE"]}<br>
              Ver: <a href="${spec["LIGA"]}" target="_blank">Abrir RMS</a>
            </div>
          `;
        });
      }

      document.getElementById("parte").addEventListener("input", buscar);
      clienteSelect.addEventListener("change", buscar);
      nombreSelect.addEventListener("change", buscar);
    });
</script>
</body>
</html>
